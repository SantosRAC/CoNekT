{% extends 'base.html' %}

{% block container %}
{% import 'macros/sequence_pagination.html' as macro %}
<div class="top-pad">

    {% if clade %}
        <h1>Clade: <strong>{{ clade.name }}</strong></h1>

        Number of species: {{ clade.species_count }}
        <br /><br />


        <div class="row">
            <div class="col-lg-12">
                <div class="panel panel-default">
                    <div class="panel-heading">Species Tree</div>
                    <div class="panel-body" id="tree_panel">
                        <div id='phylogram'></div>
                    </div>
                </div>
            </div>
        </div>



    {% endif %}
</div>

</div>
{% endblock %}

{% block extrajs %}
    {% if clade %}
    <script src="{{ url_for('static', filename='js/planet_pagination.js') }}"></script>
    <script src="{{ url_for('static', filename='js/d3.v3.min.js') }}" type="text/javascript"></script>
    <script src="{{ url_for('static', filename='js/newick.js') }}" type="text/javascript"></script>
    <script src="{{ url_for('static', filename='js/d3.phylogram.js') }}" type="text/javascript"></script>
    <script>
      function draw_tree() {
        var newick = Newick.parse("{{ clade.newick_tree }}")
        var newickNodes = []
        function buildNewickNodes(node, callback) {
          newickNodes.push(node)
          if (node.branchset) {
            for (var i=0; i < node.branchset.length; i++) {
              buildNewickNodes(node.branchset[i])
            }
          }
        }
        buildNewickNodes(newick)

        d3.phylogram.build('#phylogram', newick, {
          width: $('#tree_panel').width()-100,
          height: {{ clade.species_count*30+30 }}
        });
      }

      function resize_tree() {
          //clear div and redraw tree
          $('#phylogram').empty();
          draw_tree();
      }

      //Draw tree once the dom is ready
      $(function() {
        draw_tree();
      });

      var id;
      $( window ).resize(function() {
            clearTimeout(id);
            id = setTimeout(resize_tree, 50);
      });
    </script>
    {% endif %}
{% endblock %}